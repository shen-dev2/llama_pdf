{% extends "base.html" %}
{% block title %}Admin Dashboard - Enterprise{% endblock %}
{% block sidebar %}
<div class="sidebar">
  <h5 class="p-3">Admin Navigation</h5>
  <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-primary m-2 w-100">Dashboard</a>
</div>
{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-4 border-end">
    <h4 class="mb-3">Upload RFP Files</h4>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('upload_file') }}">
      <input class="form-control mb-2" type="file" name="file" accept=".pdf,.txt" required />
      <button type="submit" class="btn btn-primary w-100">Upload</button>
    </form>
    <h5 class="mt-4">Uploaded Files</h5>
    <ul class="list-group mb-3">
      {% for f in filenames %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>{{ f }}</span>
        <a href="{{ url_for('view_metadata', filename=f) }}" class="btn btn-sm btn-outline-secondary">Metadata</a>
      </li>
      {% else %}
      <li class="list-group-item">No files uploaded</li>
      {% endfor %}
    </ul>
  </div>
  <div class="col-lg-8">
    <h4>Knowledge Graph</h4>
    <svg id="knowledgeGraph" width="100%" height="250" style="border:1px solid #ddd;"></svg>
    <button class="btn btn-sm btn-success mt-2" onclick="downloadGraphSVG()">Download Graph</button>
    <h4 class="mt-4">Ollama Model Summary</h4>
    <div class="row">
      <div class="col-md-6">
        <p><strong>Total Documents:</strong> {{ ollama_summary.total_docs }}</p>
        <p><strong>Documents:</strong> {{ ollama_summary.list|join(', ') }}</p>
      </div>
      <div class="col-md-6">
        <p><strong>Keywords:</strong> {{ ollama_summary.keywords|join(', ') }}</p>
        <p><strong>Domains:</strong> {{ ollama_summary.domains|join(', ') }}</p>
      </div>
    </div>
  </div>
</div>
<script>
  // Draw knowledge graph using simple svg circles and lines
  const nodes = JSON.parse('{{ knowledge_graph.nodes|tojson|safe }}');
  const edges = JSON.parse('{{ knowledge_graph.edges|tojson|safe }}');
  const svg = document.getElementById("knowledgeGraph");
  svg.innerHTML = '';
  const W = svg.clientWidth;
  const H = svg.clientHeight;
  // Simple circular layout
  const centerX = W / 2;
</script>
{% endblock %}
